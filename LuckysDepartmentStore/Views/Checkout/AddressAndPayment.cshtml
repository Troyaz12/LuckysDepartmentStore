@model LuckysDepartmentStore.Models.ViewModels.Checkout.OrderModelVM
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
    
}

@using (Html.BeginForm("AddressAndPayment", "Checkout", FormMethod.Post))
{
     <h2>Address And Payment</h2>

    <div class="scrollable-section mt-2" id="shippingAddressList">
        @await Html.PartialAsync("_ShippingPartial", Model.Shipping)
    </div>
    <p><a href="" class="link-underline-primary">Edit Address</a></p>
    <div class="row">
        <div class="col-md-12">
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-primary mt-4" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                Add Shipping Address
            </button>

            <!-- Modal -->
            <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="staticBackdropLabel">Add Shipping Address</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <label for="FirstName">First Name</label>
                            <input name="FirstName" id="FirstName" class="form-control">

                            <label for="LastName">Last Name</label>
                            <input name="LastName" id="LastName" class="form-control">

                            <label for="Address1">Address1</label>
                            <input name="Address1" id="Address1" class="form-control">

                            <label for="Address2">Address2</label>
                            <input name="Address2" id="Address2" class="form-control">

                            <label for="City">City</label>
                            <input name="City" id="City" class="form-control">

                            <label for="State">State</label>
                            <input name="State" id="State" class="form-control">

                            <label for="ZipCode">ZipCode</label>
                            <input name="ZipCode" id="ZipCode" class="form-control">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button id="save" type="button" class="btn btn-primary">Save</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
     <hr />

     <div class="scrollable-section mt-2" id="paymentOptionList">
        @await Html.PartialAsync("_PaymentPartial", Model.Payment)
     </div>

    <p><a href="" class="link-underline-primary">Edit Payment Method</a></p>
    <div class="row">
        <div class="col-md-12">
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-primary mt-4" data-bs-toggle="modal" data-bs-target="#paymentBackdrop">
                Add Payment Method
            </button>

            <!-- Modal -->
            <div class="modal fade" id="paymentBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="paymentBackdropLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h1 class="modal-title fs-5" id="paymentBackdropLabel">Add Payment Method</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <label for="FirstName">First Name</label>
                            <input name="FirstName" id="FirstNamePay" class="form-control">

                            <label for="LastName">Last Name</label>
                            <input name="LastName" id="LastNamePay" class="form-control">

                            <label for="AccountNumber">Credit Card Number</label>
                            <input name="AccountNumber" id="AccountNumber" class="form-control">

                            <label for="BillingAddress1">Address 1</label>
                            <input name="BillingAddress1" id="BillingAddress1" class="form-control">

                            <label for="BillingAddress2">Address 2</label>
                            <input name="BillingAddress2" id="BillingAddress2" class="form-control">

                            <label for="City">City</label>
                            <input name="City" id="CityPay" class="form-control">

                            <label for="State">State</label>
                            <input name="State" id="StatePay" class="form-control">

                            <label for="ZipCode">ZipCode</label>
                            <input name="ZipCode" id="ZipCodePay" class="form-control">

                            <label for="CvcCode">CvcCode</label>
                            <input name="CvcCode" id="CvcCode" class="form-control">

                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button id="savePayment" type="button" class="btn btn-primary">Save</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <input type="submit" value="Submit Order" />
}

<script>
    $(document).ready(function () {

        $('#save').on('click', function (e) {
            e.preventDefault();

            console.log("Test1");

            var FirstName = $('#FirstName').val();
            var LastName = $('#LastName').val();
            var Address1 = $('#Address1').val();
            var Address2 = $('#Address2').val() || null;
            var City = $('#City').val();
            var State = $('#State').val();
            var ZipCode = $('#ZipCode').val();
            var SelectedShippingAddressID = $('#SelectedShippingAddressID').val();
            

            console.log("Test2" + " " + SelectedShippingAddressID);

            var item = {
                FirstName: FirstName,
                LastName: LastName,
                Address1: Address1,
                Address2: Address2,
                City: City,
                State: State,
                ZipCode: ZipCode
            };
            console.log("Test2.5 " + item);
            $.ajax({
                url: '@Url.Action("CreateShippingAddress", "Consumer")',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(item),

                success: function (data) {
                    $("#shippingAddressList").html(data);
                    console.log("Test3");

                    $("#FirstName").val('');
                    $("#LastName").val('');
                    $("#Address1").val('');
                    $("#Address2").val('');
                    $('#City').val('');
                    $("#State").val('');
                    $('#ZipCode').val('');
                    $('#staticBackdrop').modal('hide');
                },
                error: function (jqXHR, textStatus, errorThrown) {
                     console.log("Test4 - jqXHR: ", jqXHR);
                    console.log("Text Status: ", textStatus);
                    console.log("Error Thrown: ", errorThrown);

                    alert("Error updating list: " + errorThrown);
                }
            });
        });

        $('#savePayment').on('click', function (e) {
            e.preventDefault();

            console.log("Test1");

            var FirstName = $('#FirstNamePay').val();
            var LastName = $('#LastNamePay').val();
            var BillingAddress1 = $('#BillingAddress1').val();
            var BillingAddress2 = $('#BillingAddress2').val() || null; 
            var City = $('#CityPay').val();
            var State = $('#StatePay').val();
            var ZipCode = $('#ZipCodePay').val();
            var AccountNumber = $('#AccountNumber').val();
            var CvcCode = $('#CvcCode').val();

            console.log("Test2" + FirstName + " " + LastName + " " + BillingAddress1 + " " + BillingAddress2 + " " + City + " " + State + " " + ZipCode + " " + AccountNumber + " " + CvcCode);

            var item = {
                FirstName: FirstName,
                LastName: LastName,
                BillingAddress1: BillingAddress1,
                BillingAddress2: BillingAddress2,
                City: City,
                State: State,
                ZipCode: ZipCode,
                AccountNumber: AccountNumber,
                CvcCode: CvcCode
            };
            console.log("Test2.5 " + item);
            $.ajax({
                url: '@Url.Action("CreatePaymentOption", "Consumer")',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(item),

                success: function (data) {
                    $("#paymentOptionList").html(data);
                    console.log("Test3");

                    $("#FirstName").val('');
                    $("#LastName").val('');
                    $("#BillingAddress1").val('');
                    $("#BillingAddress2").val('');
                    $('#City').val('');
                    $("#State").val('');
                    $('#ZipCode').val('');
                    $('#AccountNumber').val('');
                    $('#CvcCode').val('');

                    $('#paymentBackdrop').modal('hide');
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log("Test4 - jqXHR: ", jqXHR);
                    console.log("Text Status: ", textStatus);
                    console.log("Error Thrown: ", errorThrown);

                    alert("Error updating list: " + errorThrown);
                }
            });
        });

    });
</script>